<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>購入完了 | イチメAI（日本語AIコーディング入門） | Winter Gator</title>
  <meta name="description" content="イチメAI（日本語AIコーディング入門）の購入完了ページです。" />
  <link rel="canonical" href="https://wintergator.com/thanks" />
  <link rel="alternate" hreflang="ja" href="https://wintergator.com/thanks" />
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/assets/logo.png" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="author" content="Winter Gator" />
  <meta name="theme-color" content="#6366f1" />
  <meta property="og:site_name" content="Winter Gator" />
  <meta property="og:title" content="購入完了 | イチメAI（日本語AIコーディング入門） | Winter Gator" />
  <meta property="og:description" content="イチメAI（日本語AIコーディング入門）の購入完了ページです。" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://wintergator.com/thanks" />
  <meta property="og:locale" content="ja_JP" />
  <meta property="og:image" content="https://wintergator.com/assets/og-default.png" />
  <meta property="og:image:secure_url" content="https://wintergator.com/assets/og-default.png" />
  <meta property="og:image:alt" content="イチメAI（日本語AIコーディング入門） | Winter Gator 購入完了のOG画像" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@WinterGator_app" />
  <meta name="twitter:creator" content="@WinterGator_app" />
  <meta name="twitter:title" content="購入完了 | イチメAI（日本語AIコーディング入門） | Winter Gator" />
  <meta name="twitter:description" content="イチメAI（日本語AIコーディング入門）の購入完了ページです。" />
  <meta name="twitter:image" content="https://wintergator.com/assets/og-default.png" />
  <meta name="twitter:image:alt" content="イチメAI（日本語AIコーディング入門） | Winter Gator 購入完了のOG画像" />
  <meta name="twitter:url" content="https://wintergator.com/thanks" />
  <link rel="stylesheet" href="/style.css" />
  <script src="/assets/site-config.js"></script>
  <script src="/site.js" defer></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QTPYX6S1D6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-QTPYX6S1D6');
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7932116761740840" crossorigin="anonymous"></script>
</head>
<body>
<a class="skip-link" href="#main">本文へスキップ</a>

<nav class="nav">
  <div class="container nav__inner">
    <a class="nav__brand" href="/">Winter Gator</a>

    <div class="nav__links">
      <a class="nav__link" href="/products/">製品一覧</a>
      <a class="nav__link" href="/demo/">デモ</a>
      <a class="nav__link" href="/start">はじめる</a>
      <a class="nav__link" href="/support.html">サポート</a>
      <a class="nav__link" href="/blog/">ブログ</a>
      <a class="btn btn--secondary btn--sm" href="/privacy.html">プライバシー</a>
      <a class="btn btn--primary btn--sm" data-stripe="buy" href="https://buy.stripe.com/cNicN59Tk84Ee6M8A414401" target="_blank" rel="noopener noreferrer">購入</a>
    </div>
  </div>
</nav>

<main id="main">
  <section class="section">
    <div class="container">
      <div class="card" style="max-width: 720px; margin-inline:auto;">
        <div class="stack stack--lg">
          <div class="stack">
            <p class="kicker">購入完了</p>
            <h1 class="h1">イチメAI（日本語AIコーディング入門）をご購入ありがとうございます</h1>
            <p class="lead">決済後すぐにダウンロードできます（この画面）。うまくいかない場合は再確認を押してください。</p>
            <p class="muted">決済完了URLには <strong>session_id</strong> が含まれます。見当たらない場合は購入完了メールのリンクからアクセスしてください。</p>
            <p class="muted">次のログインはChatGPT公式画面で行います。Plus/Pro/Business/Edu/Enterpriseでログインしてください。<strong>ChatGPT Go は使用不可</strong>です。</p>
            <p class="muted">初回起動でWindowsの警告が出る場合があります（署名準備中）。その場合は <a href="/install">インストール手順</a> をご確認ください。</p>
            <p class="muted">メール案内は必要時のみ（バックアップ）です。</p>
          </div>

          <div class="card" style="background: var(--surface-2);">
            <div class="stack">
              <h2 class="h2">ダウンロード状況</h2>
              <p class="muted" id="statusText">ステータス確認中...</p>
              <div class="cluster" id="downloadSection" hidden>
                <a class="btn btn--primary" id="downloadButton" href="#">ダウンロード</a>
                <a class="btn btn--ghost" href="/install">次にやること（インストール手順）</a>
              </div>
              <div class="cluster" id="waitingSection" hidden>
                <button class="btn btn--secondary" id="waitingRefresh" type="button">再確認</button>
                <a class="btn btn--ghost" href="/support.html">サポートへ</a>
              </div>
            </div>
          </div>

          <div class="cluster">
            <a class="btn btn--secondary" href="/start">はじめるページへ</a>
            <a class="btn btn--ghost" href="/support.html">サポートへ</a>
          </div>

          <p class="muted">ダウンロードが表示されない場合は <a href="mailto:support@wintergator.com">support@wintergator.com</a> までご連絡ください。</p>
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container footer__inner">
    <p class="muted">© Winter Gator</p>
    <div class="footer__links">
      <a href="/products/">製品一覧</a>
      <a href="/p/ichime-ai/">イチメAI</a>
      <a href="/demo/">デモ</a>
      <a href="/start">はじめる</a>
      <a href="/support.html">サポート</a>
      <a href="/blog/">ブログ</a>
      <a href="/about">運営者情報</a>
      <a href="/contact">お問い合わせ</a>
      <a href="/terms.html">利用規約</a>
      <a href="/tokusho">特商法</a>
      <a href="/privacy.html">プライバシー</a>
      <a href="/refund.html">返金</a>
    </div>
  </div>
  <div class="container">
    <p class="note">本製品はOpenAI等の公式製品ではありません。Windowsのみ（β）です。</p>
  </div>
</footer>

<script>
  const statusText = document.getElementById("statusText");
  const downloadSection = document.getElementById("downloadSection");
  const waitingSection = document.getElementById("waitingSection");
  const downloadButton = document.getElementById("downloadButton");
  const waitingRefresh = document.getElementById("waitingRefresh");
  const params = new URLSearchParams(window.location.search);
  const sessionId = params.get("session_id");

  const setReady = (dlUrl) => {
    if (statusText) statusText.textContent = "ダウンロードの準備ができました。";
    if (downloadButton) downloadButton.href = dlUrl;
    if (downloadSection) downloadSection.hidden = false;
    if (waitingSection) waitingSection.hidden = true;
  };

  const setWaiting = () => {
    if (statusText) {
      statusText.textContent = "準備中です。数十秒後に再確認してください。";
    }
    if (downloadSection) downloadSection.hidden = true;
    if (waitingSection) waitingSection.hidden = false;
  };

  const setError = (message) => {
    if (statusText) statusText.textContent = message;
    if (downloadSection) downloadSection.hidden = true;
    if (waitingSection) waitingSection.hidden = false;
  };

  const pickDownloadUrl = (data) => {
    if (!data) return null;
    if (Array.isArray(data.download) && data.download.length > 0) {
      return data.download[0].url;
    }
    return data.dlUrl || null;
  };

  const checkStatus = async () => {
    if (!sessionId) {
      setError("session_id が見つかりません。決済完了URLからアクセスしてください。");
      return;
    }
    try {
      const response = await fetch(`/api/verify?session_id=${encodeURIComponent(sessionId)}`);
      if (response.ok) {
        const data = await response.json();
        if (data.ok) {
          const dlUrl = pickDownloadUrl(data);
          if (dlUrl) {
            setReady(dlUrl);
            return;
          }
          setError("ダウンロードURLの取得に失敗しました。");
          return;
        }
        if (data.reason === "not_paid" || data.reason === "pending") {
          setWaiting();
          return;
        }
        setError("購入確認ができませんでした。サポートへご連絡ください。");
        return;
      }
    } catch (error) {
      // fall through to legacy check
    }

    try {
      const response = await fetch(`/api/order-status?session_id=${encodeURIComponent(sessionId)}`);
      if (!response.ok) {
        setError("ステータス確認に失敗しました。");
        return;
      }
      const data = await response.json();
      if (data.ready && data.dlUrl) {
        setReady(data.dlUrl);
      } else {
        setWaiting();
      }
    } catch (error) {
      setError("通信エラーが発生しました。");
    }
  };

  if (waitingRefresh) waitingRefresh.addEventListener("click", checkStatus);

  checkStatus();
</script>
</body>
</html>
